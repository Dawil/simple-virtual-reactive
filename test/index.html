<html>
  <head>
    <script src="../bower_components/virtual-dom/dist/virtual-dom.js"></script>
    <script src="../lib/simple-framework.js"></script>
    <script>
      'use strict';
      function Person(name,age) {
         this.name = name;
         this.age = age;
      }
      Person.prototype.getDOB = function() {
        return new Date().getFullYear() - this.age;
      };
      var vd = virtualDom;

      function ViewOutput() {
        return vd.h('div', [
            vd.h('p', [
              'Welcome, ',
              vd.h('span', this.p.name),
              ', born in ',
              vd.h('span', this.p.getDOB() + '.')
              ])
          ]);
      }
      function ViewForm() {
        return vd.h('div', [
            vd.h('h1','Form'),
            vd.h('label', { for: 'name' }, 'Name'),
            vd.h('input', {
              name: 'name',
              attributes: { 'data-ev-input': 'name' },
              value: this.p.name
            }),
            vd.h('label', { for: 'age' }, 'Age'),
            vd.h('input', {
              name: 'age',
              attributes: { 'data-ev-input': 'age' },
              type: 'number',
              value: this.p.age
            })
          ]);
      }

      document.addEventListener("DOMContentLoaded", function() {
        var app = new App({
          state: {
            p: new Person('dave',24),
            toggle: false
          },
          // how are the views recruited? For now let's recruit all of them.
          view: function() {
            return vd.h('div', [
                ViewForm.call(this.config.state),
                ViewOutput.call(this.config.state)
              ]);
          },
          router: {
            input: function(e) {
              if (e.target.dataset.evInput !== undefined) {
                var updateObj = {
                  name: e.target.name,
                  value: e.target.value
                };
                this.dispatch('update', updateObj );
              }
            },
            click: function(e) {
              if (e.target.dataset.evClick !== undefined) {
                this.dispatch('click', e);
              }
            }, 
          },
          model: {
            update: function(updateObj) {
              this.config.state.p[updateObj.name] = updateObj.value;
              if (updateObj.name === 'age' && updateObj.value < 0)
                this.config.state.p.age = 0;
            }
          }
        }).run(document.body);
      });
    </script>
  </head>
  <body>
  </body>
</html>
