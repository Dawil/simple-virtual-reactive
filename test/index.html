<html>
  <head>
    <script src="../bower_components/virtual-dom/dist/virtual-dom.js"></script>
    <script>
      var vd = virtualDom;
      var App = {
        Models: {
          View: function(update) {
            var render = false;
            for (var i in update) {
              if (App.State.View.p[i] !== update[i]) {
                render = true;
                App.State.View.p[i] = update[i];
              }
            }
            if (render) {
              App.Render(App.State.View.p);
            }
          }
        },
        Objects : {
          Person: function(name, age) {
           this.name = name;
           this.age = age;
          }
        },
        Listeners: {
          onchange: function(event) {
            var update = {};
            update[event.target.name] = event.target.value;
            App.Models.View(update);
          }
        },
        Views: {
          View: function(person) {
            return vd.h('div', [
                vd.h('p', 'Welcome, ' + person.name + ', age ' + person.age + '.')
              ]);
          },
          Form: function(person) {
            return vd.h('div', [
                vd.h('h1','Form'),
                vd.h('label', { for: 'name' }, 'Name'),
                vd.h('input', {
                  name: 'name',
                  onkeyup: App.Listeners.onchange,
                  value: person.name
                }),
                vd.h('label', { for: 'age' }, 'Age'),
                vd.h('input', {
                  name: 'age',
                  onkeyup: App.Listeners.onchange,
                  value: person.age
                })
              ]);
          },
          App: function(person) {
            return vd.h('div', [
                App.Views.Form(person),
                App.Views.View(person)
              ]);
          }
        },
        Render: function() {
          var newVTree = App.Views.App(App.State.View.p);
          var diff = vd.diff(App.Vtree, newVTree);
          App.Root = vd.patch(App.Root, diff);
          App.Vtree = newVTree;
        }
      };
      App.State = {
        View: {
          p: new App.Objects.Person('dave',24)
        }
      };
      App.Vtree = App.Views.App(App.State.View.p);
      App.Root = vd.create(App.Vtree);
      document.addEventListener("DOMContentLoaded", function() {
        document.body.appendChild(App.Root);
      });
    </script>
  </head>
  <body>
  </body>
</html>
