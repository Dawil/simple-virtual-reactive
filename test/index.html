<html>
  <head>
    <script src="../bower_components/virtual-dom/dist/virtual-dom.js"></script>
    <script src="../lib/simple-framework.js"></script>
    <script>
      'use strict';
      function Person(name,age) {
         this.name = name;
         this.age = age;
      }
      Person.prototype.getDOB = function() {
        return new Date().getFullYear() - this.age;
      };
      var vd = virtualDom;


      var Intent = new Emitter(function() {
        this.onInput = function(event) {
          var updateEvent = {};
          updateEvent[event.target.name] = event.target.value;
          this.dispatchEvent('input', updateEvent);
        }.bind(this);
      });
      var IntentClicker = new Emitter(function() {
        this.onClick = function(event) {
          this.dispatchEvent('click');
        }.bind(this);
      });

      var Model = new Emitter(function(state) {
        this.state = state;
        this.input = function(event) {
          for (var i in event) {
            this.state[i] = event[i];
            if (i === 'age' && event.age < 0)
              this.state.age = 0;
          }
          this.dispatchEvent('update', this.state);
        }.bind(this);
      }, new Person('dave',24));
      var ModelClicker = new Emitter(function(state) {
        this.clicked = state;
        this.toggle = function() {
          this.clicked = !this.clicked;
          this.dispatchEvent('update');
        }.bind(this);
      }, false);

      function ViewOutput(person) {
        return vd.h('div', [
            vd.h('p', [
              'Welcome, ',
              vd.h('span', person.name),
              ', born in ',
              vd.h('span', person.getDOB() + '.')
              ])
          ]);
      }
      function ViewForm(person, intent) {
        return vd.h('div', {
              oninput: intent.onInput
            }, [
            vd.h('h1','Form'),
            vd.h('label', { for: 'name' }, 'Name'),
            vd.h('input', {
              name: 'name',
              value: person.name
            }),
            vd.h('label', { for: 'age' }, 'Age'),
            vd.h('input', {
              name: 'age',
              type: 'number',
              value: person.age
            })
          ]);
      }
      var View = new Emitter(function(intent, intentClicker) {
        this.intent = intent;
        this.update = function(person) {
          this.dispatchEvent('render', vd.h('div', [
            ViewForm(person, this.intent),
            ViewOutput(person)
          ]));
        }.bind(this);
        //this.updateClicky 
        /**
         * Should all the models be merged before meeting the views or should the views find ways to get their models?
         */
      }, Intent, IntentClicker);

      document.addEventListener("DOMContentLoaded", function() {
        var MyRenderer = new Renderer(document.body);
        route(
          Intent, {
            input: Model
          },
          Model, {
            update: View
          },
          View, {
            render: MyRenderer
          }
        );
        Model.input({}); // ugly
      });

    </script>
  </head>
  <body>
  </body>
</html>
